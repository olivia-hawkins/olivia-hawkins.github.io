var Tn=Object.create;var zt=Object.defineProperty;var Mn=Object.getOwnPropertyDescriptor;var On=Object.getOwnPropertyNames;var En=Object.getPrototypeOf,Dn=Object.prototype.hasOwnProperty;var Nt=(c,e)=>()=>(e||c((e={exports:{}}).exports,e),e.exports);var xn=(c,e,i,s)=>{if(e&&typeof e=="object"||typeof e=="function")for(let o of On(e))!Dn.call(c,o)&&o!==i&&zt(c,o,{get:()=>e[o],enumerable:!(s=Mn(e,o))||s.enumerable});return c};var Cn=(c,e,i)=>(i=c!=null?Tn(En(c)):{},xn(e||!c||!c.__esModule?zt(i,"default",{value:c,enumerable:!0}):i,c));var nr=Nt(K=>{"use strict";Object.defineProperty(K,"__esModule",{value:!0});K.roundAction=K.getSpeed=K.getActionGroups=void 0;var Fn=function(c){var e=[],i=-1,s=-1;return c.forEach(function(o,u){if(u===0){e.push([o]),i++;return}if(u===1){e[i].push(o),s=Math.max(250,o.at-c[u-1].at);return}var L=o.at-c[u-1].at;L>5*s?(e.push([o]),i++):e[i].push(o),s=Math.max(250,L)}),e};K.getActionGroups=Fn;var Pn=function(c,e){if(!c||!e||c.at===e.at)return 0;try{if(e.at<c.at){var i=e;e=c,c=i}return 1e3*(Math.abs(e.pos-c.pos)/Math.abs(e.at-c.at))}catch(s){return console.error("Failed on actions",c,e,s),0}};K.getSpeed=Pn;var $n=function(c){var e={at:Math.max(0,Math.round(c.at)),pos:Math.max(0,Math.min(100,Math.round(c.pos)))};return c.subActions&&(e.subActions=c.subActions.map(function(i){return K.roundAction(i)})),c.type&&(e.type=c.type),e};K.roundAction=$n});var ir=Nt(q=>{"use strict";var de=q&&q.__assign||function(){return de=Object.assign||function(c){for(var e,i=1,s=arguments.length;i<s;i++){e=arguments[i];for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(c[o]=e[o])}return c},de.apply(this,arguments)};Object.defineProperty(q,"__esModule",{value:!0});q.convertFunscriptToCsv=q.addFunscriptMetadata=q.getFunscriptFromString=void 0;var st=nr(),_n=function(c){var e=JSON.parse(c);return q.addFunscriptMetadata(e)};q.getFunscriptFromString=_n;var Hn=function(c){var e=de({},c);e.actions=e.actions.sort(function(o,u){return o.at-u.at}).map(st.roundAction);var i=e.actions.slice(-1)[0].at,s=e.actions.reduce(function(o,u,L){if(L===0)return o;var C=st.getSpeed(e.actions[L-1],e.actions[L]);return o+C},0)/(e.actions.length-1);return e.metadata=de(de({},e.metadata),{duration:i,average_speed:s}),e};q.addFunscriptMetadata=Hn;var Un=function(c){var e=JSON.parse(c),i=e.actions.map(function(o){var u=st.roundAction(o);return u.at+","+u.pos}).join(`
`),s=new Blob([i],{type:"text/plain"});return s};q.convertFunscriptToCsv=Un});import*as Z from"buttplug";import{ButtplugWasmClientConnector as jt}from"buttplug-wasm";var Te=class{_client=new Z.ButtplugClient;_deviceRefleshedEvents=[];UFOTWReverseLR=!1;get isViberatorConnected(){return this.Devices.Viberators.length>0}get isRotatorConnected(){return this.Devices.Rotators.length>0}get isLinearsConnected(){return this.Devices.Linears.length>0}get isUFOTWConnected(){return this.Devices.UFOTW.length>0}Devices={Viberators:[],Rotators:[],Linears:[],UFOTW:[]};constructor(){console.log("buttplugOperator constructed."),this._client.addListener("deviceadded",async e=>{console.log(`device added: ${e.name}`),this.ParseDeviceList()}),this._client.addListener("deviceremoved",e=>{console.log(`device removed: ${e.name}`),this.ParseDeviceList()})}async connectWasm(){return jt.activateLogging(),this.connect(new jt)}async connectWebsocket(e){let i=new Z.ButtplugBrowserWebsocketClientConnector(e);return this.connect(i)}async connect(e){try{await this._client.connect(e)}catch(i){return console.log(`${i}`),i instanceof Z.ButtplugError&&(console.log("this is a buttplug error"),i instanceof Z.ButtplugClientConnectorException?console.log("This is a connector error"):console.log("Was another type of error")),!1}return!0}AddDevicesRefleshedEvents(e){this._deviceRefleshedEvents.push(e)}ParseDeviceList(){this.Devices.Viberators.splice(0),this.Devices.Rotators.splice(0),this.Devices.Linears.splice(0),this.Devices.UFOTW.splice(0);for(let e of this._client.devices){e.name==="Vorze UFO TW"?(this.Devices.UFOTW.push(e),e.rotate([[.3,!0],[.3,!1]]),setTimeout(()=>{e.stop()},600)):e.vibrateAttributes.length>0?(this.Devices.Viberators.push(e),e.vibrate(.5),setTimeout(()=>{e.stop()},600)):e.rotateAttributes.length>0?(this.Devices.Rotators.push(e),e.rotate(.5,!0),setTimeout(()=>{e.stop()},600)):e.linearAttributes.length>0&&(this.Devices.Linears.push(e),e.linear(0,1e3),setTimeout(()=>{e.linear(.5,1e3)},1e3),setTimeout(()=>{e.linear(0,1e3)},2e3)),console.log("Viberators:");for(let i of this.Devices.Viberators)console.log("  "+i.name);console.log("Rotators:");for(let i of this.Devices.Rotators)console.log("  "+i.name);console.log("Linears:");for(let i of this.Devices.Linears)console.log("  "+i.name)}for(let e of this._deviceRefleshedEvents)e()}StopAllDevices(){for(let e of this.Devices.Viberators)e.stop();for(let e of this.Devices.Rotators)e.stop();for(let e of this.Devices.Linears)e.stop();for(let e of this.Devices.UFOTW)e.stop()}ForceStopAllDevices(){this.SendViberateCmd(.1),this.SendRotateCmd(.2,!0),this.SendLinearCmd(.2,1e3),this.SendUFOTWCmd(.2,!0,.2,!0),setTimeout(()=>{this.StopAllDevices()},500)}SendViberateCmd(e){console.log("SendViberateCmd: "+e),this.Devices.Viberators.forEach(i=>{i.vibrate(e)})}SendRotateCmd(e,i){this.Devices.Rotators.forEach(s=>{s.rotate(e,i)})}SendLinearCmd(e,i){this.Devices.Linears.forEach(s=>{s.linear(e,i)})}SendUFOTWCmd(e,i,s,o){this.Devices.UFOTW.forEach(u=>{this.UFOTWReverseLR?u.rotate([[s,o],[e,i]]):u.rotate([[e,i],[s,o]])})}async ConnectDevice(){this._client.connected?await this._client.startScanning():console.log("buttplug client is not connected.")}};var P=class{Milliseconds=0;Power=0;constructor(e,i){this.Milliseconds=e,i<0?this.Power=0:i>1e3?this.Power=1e3:this.Power=i}get ButtPower(){return this.Power/1e3}get Seconds(){return Math.trunc(this.Milliseconds/1e3)}get HHMMSS(){let e=Math.floor(this.Milliseconds/1e3),i=Math.floor(e/60),s=Math.floor(i/60),o=String(e%60).padStart(2,"0"),u=String(i%60).padStart(2,"0");return`${String(s).padStart(2,"0")}:${u}:${o}`}toString(){return`Time: ${this.Milliseconds}, Power: ${this.ButtPower}`}},qt=/^([0-9]+)(\.[0-9]{1,2})?,(1000|[0-9]+)$/;function Jt(c){let i=c.replace(/\r\n|\r/g,`
`).split(/\n/);i.slice(-1)[0]===""&&i.pop();let s=!0;for(let o=0;o<i.length;o++)if(!i[o].match(qt)){s=!1;break}return s}function Yt(c){let i=c.replace(/\r\n|\r/g,`
`).split(/\n/),s=[];for(let o of i){let u=o.match(qt);if(u){let L=Number(u[1])*1e3;if(u[2]){let J=u[2].replace(".",""),X;J.length==1?X=Number(J)*10:X=Number(J),L+=X*10}let C=Number(u[3]),U=new P(L,C);s.push(U)}}return console.log("script start time: "+s[0].HHMMSS),s}function rt(c){let e=[];for(let s of c){let o=s.Seconds;e[o]||(e[o]=[]),e[o].push(s)}return e}var Rn=[new P(500,800),new P(600,0),new P(1500,400),new P(1600,0),new P(2500,800),new P(2600,0),new P(3500,400),new P(3600,0),new P(4500,800),new P(4600,0),new P(5500,400),new P(5600,0),new P(6500,800),new P(6600,0),new P(7500,400),new P(7600,0)],jn=rt(Rn);var nt=class{Milliseconds=0;Clockwise=!0;Power=0;get ButtPower(){return this.Power/100}get Seconds(){return Math.trunc(this.Milliseconds/1e3)}get HHMMSS(){let e=Math.floor(this.Milliseconds/1e3),i=Math.floor(e/60),s=Math.floor(i/60),o=String(e%60).padStart(2,"0"),u=String(i%60).padStart(2,"0");return`${String(s).padStart(2,"0")}:${u}:${o}`}constructor(e,i,s){this.Milliseconds=e,this.Clockwise=i,s<0?this.Power=0:s>100?this.Power=100:this.Power=s}toString(){return`Time: ${this.Milliseconds}, Clockwise: ${this.Clockwise} Power: ${this.ButtPower}`}},Gt=/^([0-9]+),(0|1),(100|[0-9]{1,2})$/;function Kt(c){let i=c.replace(/\r\n|\r/g,`
`).split(/\n/);i.slice(-1)[0]===""&&i.pop();let s=!0;for(let o=0;o<i.length;o++)if(!i[o].match(Gt)){s=!1;break}return s}function Xt(c){let i=c.replace(/\r\n|\r/g,`
`).split(/\n/),s=[];for(let o of i){let u=o.match(Gt);if(u){let L=Number(u[1])*100,C=u[2]==="1",U=Number(u[3]),J=new nt(L,C,U);s.push(J)}}return console.log("script start time: "+s[0].HHMMSS),s}function Qt(c){let e=[];for(let s of c){let o=s.Seconds;e[o]||(e[o]=[]),e[o].push(s)}return e}var it=class{Milliseconds=0;LeftClockwise=!0;LeftPower=0;RightClockwise=!0;RightPower=0;get LeftButtPower(){return this.LeftPower/100}get RightButtPower(){return this.RightPower/100}get Seconds(){return Math.trunc(this.Milliseconds/1e3)}get HHMMSS(){let e=Math.floor(this.Milliseconds/1e3),i=Math.floor(e/60),s=Math.floor(i/60),o=String(e%60).padStart(2,"0"),u=String(i%60).padStart(2,"0");return`${String(s).padStart(2,"0")}:${u}:${o}`}constructor(e,i,s,o,u){this.Milliseconds=e,this.LeftClockwise=i,this.RightClockwise=o,s<0?this.LeftPower=0:s>100?this.LeftPower=100:this.LeftPower=s,u<0?this.RightPower=0:u>100?this.RightPower=100:this.RightPower=u}toString(){return`Time: ${this.Milliseconds}, LeftClockwise: ${this.LeftClockwise} LeftPower: ${this.LeftButtPower}, LeftClockwise: ${this.RightClockwise} LeftPower: ${this.RightButtPower}`}},Zt=/^([0-9]+),(0|1),(100|[0-9]{1,2}),(0|1),(100|[0-9]{1,2})$/;function er(c){let i=c.replace(/\r\n|\r/g,`
`).split(/\n/);i.slice(-1)[0]===""&&i.pop();let s=!0;for(let o=0;o<i.length;o++)if(!i[o].match(Zt)){s=!1;break}return s}function tr(c){let i=c.replace(/\r\n|\r/g,`
`).split(/\n/),s=[];for(let o of i){let u=o.match(Zt);if(u){let L=Number(u[1])*100,C=u[2]==="1",U=Number(u[3]),J=u[4]==="1",X=Number(u[5]),ue=new it(L,C,U,J,X);s.push(ue)}}return console.log("script start time: "+s[0].HHMMSS),s}function rr(c){let e=[];for(let s of c){let o=s.Seconds;e[o]||(e[o]=[]),e[o].push(s)}return e}var ot=Cn(ir(),1),Me=class{Title;Origin;Ranged;Splitted;get OriginMin(){return this.getMin(this.Origin)}get OriginMax(){return this.getMax(this.Origin)}get RangedMin(){return this.getMin(this.Ranged)}get RangedMax(){return this.getMax(this.Ranged)}constructor(e,i){this.Title=e;let s=(0,ot.getFunscriptFromString)(i),o=this.ConvertJsonToScript(s);console.log("funscript loaded. lines: "+o.length),console.log("script start time: "+o[0].HHMMSS),this.Origin=o,this.Ranged=o,this.Splitted=this.SplitLines(o)}ConvertJsonToScript(e){let i=e.actions,s=[],o=0;for(let u of i){let L=u.at-o;s.push(new Oe(o,u.pos,L)),o=u.at}return s}SetRange(e,i){let s=[];for(let o of this.Origin){let u=this.normalize(o.Position,this.OriginMin,this.OriginMax,e,i),L=new Oe(o.Milliseconds,u,o.Duration);s.push(L)}this.Ranged=s,this.Splitted=this.SplitLines(s);for(let o=0;o<10;o++)console.log(this.Ranged[o]);console.log("newmin: "+this.getMin(this.Ranged)),console.log("newmax: "+this.getMax(this.Ranged)),console.log("splitted.length: "+this.Splitted.length)}Validate(e){try{let i=(0,ot.getFunscriptFromString)(e);return!0}catch{return console.log("Loading funscript is failed."),!1}}getMin(e){let i=e.map(o=>o.Position),s=(o,u)=>Math.min(o,u);return i.reduce(s)}getMax(e){let i=e.map(o=>o.Position),s=(o,u)=>Math.max(o,u);return i.reduce(s)}SplitLines(e){let i=[];for(let o of e){let u=o.Seconds;i[u]||(i[u]=[]),i[u].push(o)}return i}normalize(e,i,s,o,u){if(i>s)throw new RangeError("oldMin is greater than oldMax.");if(o>u)throw new RangeError("newMin is greater than newMax.");e>s&&(e=s),e<i&&(e=i);let L=s-i,C=u-o;return(e-i)*C/L+o}},Oe=class{Milliseconds=0;Position=0;Duration=0;get Seconds(){return Math.trunc(this.Milliseconds/1e3)}get ButtPosition(){return this.Position/100}get HHMMSS(){let e=this.Seconds,i=Math.floor(e/60),s=Math.floor(i/60),o=String(e%60).padStart(2,"0"),u=String(i%60).padStart(2,"0");return`${String(s).padStart(2,"0")}:${u}:${o}`}constructor(e,i,s){if(e<0)throw new RangeError("milliseconds does not accept negative values.");if(i<0||i>100)throw new RangeError("position does not accept values outside the range 0 to 100.");if(s<0)throw new RangeError("milliseconds does not accept negative values.");this.Milliseconds=e,this.Duration=s,this.Position=i}toString(){return`Time: ${this.Milliseconds}, Positon: ${this.Position}, Duration: ${this.Duration}`}};var Ee=class{_buttplugOperator;_previousSeconds=0;_timerIDs=new Set;VorzeSAScriptToUFOTW=!1;Offset=0;Scripts={TimeRoter:void 0,Vorze_SA:void 0,Funscript:void 0,UFOTW:void 0};constructor(e){this._buttplugOperator=e}LoadScript(e,i){if(console.log("path: "+i),i.endsWith(".funscript"))return this.Scripts.Funscript=new Me(i,e),!0;if(Jt(e)){let s=Yt(e);return this.Scripts.TimeRoter={Script:s,Splitted:rt(s),Title:i},console.log("timeroter script loaded. lines: "+s.length),!0}else if(er(e)){let s=tr(e);return this.Scripts.UFOTW={Script:s,Splitted:rr(s),Title:i},console.log("UFOTW script loaded. lines: "+s.length),!0}else if(Kt(e)){let s=Xt(e);return this.Scripts.Vorze_SA={Script:s,Splitted:Qt(s),Title:i},console.log("Vorze_SA script loaded. lines: "+s.length),!0}else return!1}Stop(){this._previousSeconds=0,this._buttplugOperator.StopAllDevices(),this._timerIDs.forEach(e=>{clearTimeout(e)}),this._timerIDs.clear()}TimeUpdate(e){let i=e+this.Offset,s=Math.trunc(i);s!==this._previousSeconds&&(this.OperateTimeRoterScript(i),this.OperateVorzeSAScript(i),this.OperateFunscript(i),this.OperateUFOTWScript(i),this._previousSeconds=s)}SetFunscriptRange(e,i){this.Scripts.Funscript?.SetRange(e,i)}OperateTimeRoterScript(e){if(!this.Scripts.TimeRoter)return;let i=Math.trunc(e),s=this.Scripts.TimeRoter.Splitted;this._buttplugOperator.isViberatorConnected&&i!==this._previousSeconds&&s[i+1]&&s[i+1].forEach(o=>{let u=o.Milliseconds-Math.trunc(e*1e3),L=`send ViberateMsg: ${o.toString()}`;setTimeout(()=>console.log(L),u);let C=window.setTimeout(()=>{this._buttplugOperator.SendViberateCmd(o.ButtPower)},u);this._timerIDs.add(C),setTimeout(()=>{this._timerIDs.delete(C)},3e3)})}OperateVorzeSAScript(e){if(!this.Scripts.Vorze_SA)return;let i=Math.trunc(e),s=this.Scripts.Vorze_SA.Splitted;(this._buttplugOperator.isRotatorConnected||this.VorzeSAScriptToUFOTW&&this._buttplugOperator.isUFOTWConnected)&&i!==this._previousSeconds&&s[i+1]&&s[i+1].forEach(u=>{let L=u.Milliseconds-Math.trunc(e*1e3),C=`send RotateMsg: ${u.toString()}`;setTimeout(()=>console.log(C),L);let U=window.setTimeout(()=>{this._buttplugOperator.SendRotateCmd(u.ButtPower,u.Clockwise),this.VorzeSAScriptToUFOTW&&this._buttplugOperator.SendUFOTWCmd(u.ButtPower,u.Clockwise,u.ButtPower,u.Clockwise)},L);this._timerIDs.add(U),setTimeout(()=>{this._timerIDs.delete(U)},3e3)})}OperateUFOTWScript(e){if(!this.Scripts.UFOTW)return;let i=Math.trunc(e),s=this.Scripts.UFOTW.Splitted;this._buttplugOperator.isUFOTWConnected&&!this.VorzeSAScriptToUFOTW&&i!==this._previousSeconds&&s[i+1]&&s[i+1].forEach(o=>{let u=o.Milliseconds-Math.trunc(e*1e3),L=`send RotateMsg: ${o.toString()}`;setTimeout(()=>console.log(L),u);let C=window.setTimeout(()=>{this._buttplugOperator.SendUFOTWCmd(o.LeftButtPower,o.LeftClockwise,o.RightButtPower,o.RightClockwise)},u);this._timerIDs.add(C),setTimeout(()=>{this._timerIDs.delete(C)},3e3)})}OperateFunscript(e){if(!this.Scripts.Funscript)return;let i=Math.trunc(e),s=e*1e3,o=this.Scripts.Funscript.Splitted;this._buttplugOperator.isLinearsConnected&&i!==this._previousSeconds&&o[i+1]&&o[i+1].forEach(u=>{let L=u.Milliseconds-s,C=`send LinearMsg: ${u.toString()}`;setTimeout(()=>console.log(C),L);let U=window.setTimeout(()=>{this._buttplugOperator.SendLinearCmd(u.ButtPosition,u.Duration)},L);this._timerIDs.add(U),setTimeout(()=>{this._timerIDs.delete(U)},3e3)})}};var De=class{Player=document.getElementById("player");MediaNameSpan=document.getElementById("mediaNameSpan");OffsetInput=document.getElementById("offset");OffsetPlusButton=document.getElementById("offsetPlusButton");OffsetMinusButton=document.getElementById("offsetMinusButton");UFOTWsettingli=document.getElementsByClassName("UFOTWsettingli");UFOTWreverseLRCheckbox=document.getElementById("UFOTWreverseLRCheckbox");VorzeSAScriptToUFOTWCheckbox=document.getElementById("VorzeSAScriptToUFOTWCheckbox");VibDeviceList=document.getElementById("VibDeviceList");RotatorDeviceList=document.getElementById("RotatorDeviceList");LinearDeviceList=document.getElementById("LinearDeviceList");UFOTWDeviceList=document.getElementById("UFOTWDeviceList");TimeRoterScriptList=document.getElementById("TimeRoterScriptList");VorzeSAScriptList=document.getElementById("VorzeSAScriptList");FunscriptList=document.getElementById("FunscriptList");UFOTWScriptList=document.getElementById("UFOTWScriptList");ScriptInput=document.getElementById("scriptInput");MediaInput=document.getElementById("mediaInput");ConnectServerButton=document.getElementById("connectServerButton");ConnectDeviceButton=document.getElementById("connectDeviceButton");ConnectStatusSpan=document.getElementById("connectStatus");ForceStopButton=document.getElementById("forceStopButton");FunscriptSlider;AppendToList(e,i){let s=document.createElement("li"),o=document.createElement("span");return o.className="name",o.innerText=i,s.appendChild(o),e.appendChild(s),s}AppendVibDeviceList(e){this.AppendToList(this.VibDeviceList,e)}AppendRotatorDeviceList(e){this.AppendToList(this.RotatorDeviceList,e)}AppendLinearDeviceList(e){this.AppendToList(this.LinearDeviceList,e)}AppendUFOTWDeviceList(e){this.AppendToList(this.UFOTWDeviceList,e)}AppendTimeRoterScriptList(e){this.AppendToList(this.TimeRoterScriptList,e)}AppendVorzeSAScriptList(e){this.AppendToList(this.VorzeSAScriptList,e)}AppendUFOTWScriptList(e){this.AppendToList(this.UFOTWScriptList,e)}AppendFunscriptList(e){let i=this.AppendToList(this.FunscriptList,e),s=document.createElement("slider-container");i.appendChild(s),s.InitializeSlider(),this.FunscriptSlider=s}ClearDeviceLists(){this.VibDeviceList.innerHTML="",this.RotatorDeviceList.innerHTML="",this.LinearDeviceList.innerHTML=""}ClearScriptLists(){this.TimeRoterScriptList.innerHTML="",this.VorzeSAScriptList.innerHTML="",this.FunscriptList.innerHTML="",this.UFOTWScriptList.innerHTML=""}AddFunscriptSliderUpdateEvent(e){let i=this.FunscriptSlider;i?.addEventListener("mouseup",()=>{e(i.range_min,i.range_max)})}};var xe=class{ButtplugOperator;ScriptOperator;UI;constructor(){this.ButtplugOperator=new Te,this.ScriptOperator=new Ee(this.ButtplugOperator),this.UI=new De,this.addEvents()}async ConnectWasm(){let e=this.UI.ConnectStatusSpan;e.innerText="Buttplug\u6E96\u5099\u4E2D..",await this.ButtplugOperator.connectWasm()?e.innerText="Buttplug\u6E96\u5099\u5B8C\u4E86":e.innerText="Buttplug\u6E96\u5099\u306B\u5931\u6557\u3057\u307E\u3057\u305F"}async ConnectServer(){let e=document.getElementById("serverURL"),i=this.UI.ConnectStatusSpan;i.innerText="\u63A5\u7D9A\u4E2D...",await this.ButtplugOperator.connectWebsocket("ws://"+e.value)?i.innerText="\u63A5\u7D9A\u6210\u529F: "+e.value:i.innerText="\u63A5\u7D9A\u5931\u6557"}RefleshDeviceLists(){let e=this.UI;e.ClearDeviceLists();for(let i of this.ButtplugOperator.Devices.Viberators)e.AppendVibDeviceList(i.name);for(let i of this.ButtplugOperator.Devices.Rotators)e.AppendRotatorDeviceList(i.name);for(let i of this.ButtplugOperator.Devices.Linears)e.AppendLinearDeviceList(i.name);if(this.ButtplugOperator.Devices.UFOTW.length>0){for(let i of this.ButtplugOperator.Devices.UFOTW)e.AppendUFOTWDeviceList(i.name);for(let i of e.UFOTWsettingli)i.style.display="list-item"}else for(let i of e.UFOTWsettingli)i.style.display="none"}RefleshScriptLists(){let e=this.UI;e.ClearScriptLists();let i=this.ScriptOperator.Scripts.TimeRoter,s=this.ScriptOperator.Scripts.Vorze_SA,o=this.ScriptOperator.Scripts.Funscript,u=this.ScriptOperator.Scripts.UFOTW;i&&e.AppendTimeRoterScriptList(i.Title),s&&e.AppendVorzeSAScriptList(s.Title),u&&e.AppendUFOTWScriptList(u.Title),o&&(e.AppendFunscriptList(o.Title),e.FunscriptSlider.range_min=o.RangedMin,e.FunscriptSlider.range_max=o.RangedMax,e.FunscriptSlider.addEventListener("mouseup",()=>{let L=e.FunscriptSlider.range_min,C=e.FunscriptSlider.range_max;o.SetRange(L,C)}))}OffsetValueChanged(e){this.ScriptOperator.Offset=e}OffsetPlusMinusButtonEvent(e){let i=this.UI.OffsetInput,s=Number(i.value);e?s+=.1:s-=.1,s=Math.round(s*100)/100,i.value=String(s),this.OffsetValueChanged(s)}LoadScript(){let e=this.UI.ScriptInput.files[0];if(e!=null){let i=new FileReader;i.readAsText(e),i.onload=()=>{i.result&&this.ScriptOperator.LoadScript(i.result,e.name)&&this.RefleshScriptLists()},i.onerror=()=>{console.log(i.error)}}}LoadMedia(){let e=this.UI,i=e.MediaInput.files;i&&(i[0].type.startsWith("video/")?(e.Player.src=URL.createObjectURL(i[0]),e.Player.style.height="auto",e.MediaNameSpan.innerText=i[0].name):i[0].type.startsWith("audio/")?(e.Player.src=URL.createObjectURL(i[0]),e.Player.style.height="3em",e.MediaNameSpan.innerText=i[0].name):e.MediaNameSpan.innerText="\u3053\u306E\u30D5\u30A1\u30A4\u30EB\u306F\u518D\u751F\u3067\u304D\u307E\u305B\u3093: "+i[0].name,e.MediaInput.files=null)}addEvents(){console.log("addEvent() called.");let e=this.UI;e.Player.addEventListener("timeupdate",()=>{e.Player.paused||this.ScriptOperator.TimeUpdate(e.Player.currentTime)}),e.Player.addEventListener("pause",()=>this.ScriptOperator.Stop()),e.Player.addEventListener("ended",()=>this.ScriptOperator.Stop()),e.ScriptInput.addEventListener("input",()=>{this.LoadScript()}),document.getElementById("scriptButton").addEventListener("click",()=>{e.ScriptInput?.click()}),e.MediaInput.addEventListener("input",()=>{this.LoadMedia()}),document.getElementById("mediaButton")?.addEventListener("click",()=>{e.MediaInput.click()}),e.UFOTWreverseLRCheckbox.addEventListener("change",()=>{this.ButtplugOperator.UFOTWReverseLR=this.UI.UFOTWreverseLRCheckbox.checked}),e.VorzeSAScriptToUFOTWCheckbox.addEventListener("change",()=>{this.ScriptOperator.VorzeSAScriptToUFOTW=this.UI.VorzeSAScriptToUFOTWCheckbox.checked}),e.OffsetInput.addEventListener("change",()=>{this.OffsetValueChanged(Number(e.OffsetInput.value))}),e.OffsetPlusButton.addEventListener("click",()=>this.OffsetPlusMinusButtonEvent(!0)),e.OffsetMinusButton.addEventListener("click",()=>this.OffsetPlusMinusButtonEvent(!1)),e.ConnectDeviceButton.addEventListener("click",async()=>{await this.ButtplugOperator.ConnectDevice()}),e.ConnectServerButton!=null?e.ConnectServerButton?.addEventListener("click",async()=>this.ConnectServer()):this.ConnectWasm(),this.ButtplugOperator.AddDevicesRefleshedEvents(()=>this.RefleshDeviceLists()),e.ForceStopButton.addEventListener("click",()=>{this.ButtplugOperator.ForceStopAllDevices()})}};(()=>{var c=Object.defineProperty,e=Math.pow,i=(t,n,a)=>n in t?c(t,n,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[n]=a,s=(t,n,a)=>(i(t,typeof n!="symbol"?n+"":n,a),a),o=(t,n)=>` ${n&&n.length>0?n.map(a=>`<link rel="stylesheet" href="${a}" />`).join(""):""} <style> ${t} </style> <div class="range-slider-box"> <div class="row"> <div id="range-slider" class="range-slider"> <div class="container"> <div class="panel"></div> <div class="panel-fill"></div> <div class="container"> <div class="pointer" tabindex="0" role="slider"> <div class="pointer-shape"></div> </div> </div> </div> </div> </div> </div>`,u=":host{--width:300px;--height:.25rem;--opacity:.4;--panel-bg:#cbd5e1;--panel-bg-hover:#94a3b8;--panel-bg-fill:#475569;--panel-bg-border-radius:1rem;--pointer-width:1rem;--pointer-height:1rem;--pointer-bg:#fff;--pointer-bg-hover:#dcdcdc;--pointer-bg-focus:#dcdcdc;--pointer-shadow:0 0 2px rgba(0,0,0,0.8);--pointer-shadow-hover:0 0 2px #000;--pointer-shadow-focus:var(--pointer-shadow-hover);--pointer-border:1px solid hsla(0,0%,88%,0.5);--pointer-border-hover:1px solid #94a3b8;--pointer-border-focus:var(--pointer-border-hover);--pointer-border-radius:100%;--animate-onclick:.3s}:host{max-width:100%}.range-slider-box{display:flex;position:relative;flex-direction:column}.range-slider{position:relative;width:var(--width,100%);height:var(--height,0.25rem);touch-action:none;max-width:100%;box-sizing:border-box;cursor:pointer}.row{width:100%;display:flex;align-items:center}.range-slider.disabled{opacity:var(--opacity,0.4);cursor:default}.pointer.disabled{-webkit-filter:brightness(0.8);filter:brightness(0.8);cursor:default}.range-slider *{box-sizing:border-box}.container{position:absolute;width:100%;height:100%}.panel{position:absolute;z-index:10;width:100%;height:100%;background:var(--panel-bg,#2d4373);border-radius:var(--panel-bg-border-radius,1rem);overflow:hidden;transition:.3s all ease}.panel-fill{background:var(--panel-bg-fill,#000);border-radius:var(--panel-bg-border-radius,1rem);overflow:hidden;height:100%;position:absolute;z-index:10}.panel:hover{background:var(--panel-bg-hover,#5f79b7)}.disabled .panel:hover{background:var(--panel-bg,#5f79b7)}.pointer{position:absolute;z-index:20;outline:0;top:50%;-webkit-transform:translateY(-50%);transform:translateY(-50%)}.pointer-shape{background:var(--pointer-bg,#fff);background-size:contain;box-shadow:var(--pointer-shadow);border:var(--pointer-border);border-radius:var(--pointer-border-radius,100%);-webkit-transform:translateX(-50%);transform:translateX(-50%);width:var(--pointer-width,15px);height:var(--pointer-height,15px);transition:.3s all ease}.pointer-shape:hover{background:var(--pointer-bg-hover,#fff);background-size:contain;border:var(--pointer-border-hover);box-shadow:var(--pointer-shadow-hover)}.disabled .pointer-shape:hover{background:var(--pointer-bg,#fff);background-size:contain;border:var(--pointer-border);box-shadow:var(--pointer-shadow)}.pointer:focus .pointer-shape{background:var(--pointer-bg-focus,#fff);background-size:contain;border:var(--pointer-border-focus);box-shadow:var(--pointer-shadow-focus)}.disabled .pointer:focus .pointer-shape{background:var(--pointer-bg,#fff);background-size:contain;border:var(--pointer-border);box-shadow:var(--pointer-shadow)}.type-vertical .range-slider{--width:.25rem;--height:300px;max-height:100%}.type-vertical .range-slider .pointer{left:50%}.type-vertical .range-slider .panel-fill{width:100%}.type-vertical.range-slider-box{flex-direction:row}.type-vertical .row{flex-direction:column}.animate-on-click .pointer,.animate-on-click .panel-fill{transition:all var(--animate-onclick)}.range-dragging .panel-fill{cursor:move}",L="pointers-overlap",C="pointers-min-distance",U="pointers-max-distance",J="range-dragging",X="data",ue="min",lt="max",at="step",dt="round",ut="type",ct="theme",pt="rtl",ht="btt",gt="disabled",mt="keyboard-disabled",ft="mousewheel-disabled",sr="slider-width",or="slider-height",lr="slider-radius",ar="slider-bg",dr="slider-bg-hover",ur="slider-bg-fill",cr="pointer-width",pr="pointer-height",hr="pointer-radius",gr="pointer-bg",mr="pointer-bg-hover",fr="pointer-bg-focus",vr="pointer-shadow",br="pointer-shadow-hover",Sr="pointer-shadow-focus",Lr="pointer-border",yr="pointer-border-hover",wr="pointer-border-focus",vt="animate-onclick",Tr="css-links",N="vertical",re="horizontal",Re=(t,n,a,l,p)=>{let v=n-t;return v===0?a:(l-a)*(p-t)/v+a},G=t=>!isNaN(parseFloat(t))&&isFinite(t),A=(t,n)=>G(t)?Number(t):n,bt=(t,n)=>n===0?0:Math.round(t/n)*n,Mr=(t,n=1/0)=>{if(n===1/0)return t;let a=e(10,n);return Math.round(t*a)/a},_=t=>t==null?!1:typeof t=="boolean"?t:t.trim().toLowerCase()==="true",Or=(t,n)=>{t.dispatchEvent(new CustomEvent("onPointerClicked",{detail:{$pointer:n}}))},Er=(t,n)=>{t.dispatchEvent(new CustomEvent("onMouseDown",{detail:{nativeEvent:n}}))},Dr=(t,n)=>{t.dispatchEvent(new CustomEvent("onMouseUp",{detail:{nativeEvent:n}}))},xr=(t,n)=>{t.dispatchEvent(new CustomEvent("onKeyDown",{detail:{nativeEvent:n}}))},Cr=(t,n)=>{if(!n||n.length<=0)return;let a=n.map(p=>G(p)?A(p,p):p),l={values:a||[]};l.value=a[0],l.value0=a[0],l.value1=a[0];for(let p=1;p<a.length;p++)l[`value${p+1}`]=a[p];t.dispatchEvent(new CustomEvent("change",{detail:l}))},Be=(t,n,a)=>{let l=0,p,v,y,h,g=!1,w=(S,x,$,F,R,B)=>{let I=l;$!==void 0&&S>$&&(S=$),x!==void 0&&S<x&&(S=x),l=S;let W=l;return(F===N&&B||F===re&&R)&&(W=100-W),F===N?n.style.top=`${W}%`:n.style.left=`${W}%`,I!==l},M=S=>S===n||n.contains(S),f=(S,x,$,F)=>{p=S,v=x,y=$,h=F},E=S=>{g=S,n.classList.toggle("disabled",g),g?n.setAttribute("aria-disabled","true"):n.hasAttribute("aria-disabled")&&n.removeAttribute("aria-disabled")},z=(S,x)=>{x==null?n.removeAttribute(S):n.setAttribute(S,x)},H=S=>n.getAttribute(S),b=S=>{if(!g){switch(S.key){case"ArrowLeft":{S.preventDefault(),typeof p=="function"&&p(a);break}case"ArrowRight":{S.preventDefault(),typeof v=="function"&&v(a);break}case"ArrowUp":{S.preventDefault(),typeof y=="function"&&y(a);break}case"ArrowDown":{S.preventDefault(),typeof h=="function"&&h(a);break}}xr(t,S)}},T=()=>{g||Or(t,n)};return n.className=`pointer pointer-${a}`,n.addEventListener("keydown",b),n.addEventListener("click",T),{$pointer:n,get percent(){return l},get disabled(){return g},set disabled(S){E(S)},updatePosition:w,isClicked:M,setCallbacks:f,setAttr:z,getAttr:H,destroy:()=>{n.removeEventListener("keydown",b),n.removeEventListener("click",T),n.remove()}}},Rr=t=>{if(t==null)return;if(Array.isArray(t))return t;if(t.trim()==="")return;let n=t.split(","),a=[],l=!0;for(let p=0;p<n.length;p++){let v=n[p].trim();v!==""&&(a.push(v),G(v)||(l=!1))}return l?a.map(p=>Number(p)):a},Br=(t,n)=>n?n.findIndex(a=>a===t||a.toString().trim()===t.toString().trim()):-1,kr=t=>({updatePosition:(n,a,l,p)=>{if(a.length<=0)return;let v=a.length===1,y=a[0],h=a[a.length-1];n===N?(t.style.removeProperty("width"),t.style.removeProperty("right"),t.style.removeProperty("left"),v?t.style.height=`${y}%`:t.style.height=`${Math.abs(y-h)}%`,p?(t.style.bottom="0%",v?t.style.top="auto":t.style.top=`${Math.min(100-h,100-y)}%`):(t.style.bottom="auto",v?t.style.top="0%":t.style.top=`${Math.min(y,h)}%`)):(t.style.removeProperty("height"),t.style.removeProperty("top"),t.style.removeProperty("bottom"),v?t.style.width=`${y}%`:t.style.width=`${Math.abs(y-h)}%`,l?(t.style.right="0%",v?t.style.left="auto":t.style.left=`${Math.min(100-h,100-y)}%`):(t.style.right="auto",v?t.style.left="0%":t.style.left=`${Math.min(y,h)}%`))}}),St="--animate-onclick",Ar="--width",Fr="--height",Pr="--panel-bg-border-radius",$r="--panel-bg",_r="--panel-bg-hover",Hr="--panel-bg-fill",Ur="--pointer-width",Ir="--pointer-height",Wr="--pointer-border-radius",Vr="--pointer-bg",zr="--pointer-bg-hover",Nr="--pointer-bg-focus",jr="--pointer-shadow",qr="--pointer-shadow-hover",Jr="--pointer-shadow-focus",Yr="--pointer-border",Gr="--pointer-border-hover",Kr="--pointer-border-focus",ce=(t,n,a)=>{let l=new Map;for(let p of t.attributes){let v=p.nodeName.trim().toLowerCase();if(!n.test(v))continue;let y=v.replace(/\D/g,"").trim(),h=y===""||y==="0"||y==="1"?0:A(y,0)-1,g=a&&typeof a=="function"?a(p.value):p.value;l.set(h,g)}return l},Xr=t=>{if(!t)return null;let n=t.getAttribute(Tr);if(!n)return null;let a=n.split(";"),l=[];for(let p of a)p.trim()!==""&&l.push(p.trim());return l},Lt=[[Ar,sr,"sliderWidth",null],[Fr,or,"sliderHeight",null],[Pr,lr,"sliderRadius",null],[$r,ar,"sliderBg",null],[_r,dr,"sliderBgHover",null],[Hr,ur,"sliderBgFill",null],[Ur,cr,"pointer#Width",/^pointer([0-9]*)-width$/],[Ir,pr,"pointer#Height",/^pointer([0-9]*)-height$/],[Wr,hr,"pointer#Radius",/^pointer([0-9]*)-radius$/],[Vr,gr,"pointer#Bg",/^pointer([0-9]*)-bg$/],[zr,mr,"pointer#BgHover",/^pointer([0-9]*)-bg-hover$/],[Nr,fr,"pointer#BgFocus",/^pointer([0-9]*)-bg-focus$/],[jr,vr,"pointer#Shadow",/^pointer([0-9]*)-shadow$/],[qr,br,"pointer#ShadowHover",/^pointer([0-9]*)-shadow-hover$/],[Jr,Sr,"pointer#ShadowFocus",/^pointer([0-9]*)-shadow-focus$/],[Yr,Lr,"pointer#Border",/^pointer([0-9]*)-border$/],[Gr,yr,"pointer#BorderHover",/^pointer([0-9]*)-border-hover$/],[Kr,wr,"pointer#BorderFocus",/^pointer([0-9]*)-border-focus$/]],Qr=(t,n,a)=>{let l=null,p=[],v=new Map,y=(b,T=n)=>{let S=[...T.classList];for(let x of S)x.startsWith(b)&&n.classList.remove(x)},h=()=>{y("shape");let b=n.querySelectorAll(".pointer");for(let T of b)y("shape",T)},g=b=>{l=b,y("theme-"),typeof b=="string"&&n.classList.add(`theme-${b}`)},w=()=>{if(h(),!(p.length<=0)){n.classList.add("shape",`shape-${p[0]}`);for(let b=1;b<p.length;b++){let T=p[b];if(!T)continue;let S=n.querySelector(`.pointer-${b}`);!S||S.classList.add("shape",`shape-${T}`)}}},M=(b,T)=>{p[b]=T,w()},f=()=>{h();let b=ce(t,/^pointer([0-9]*)-shape$/);if(!(b.size<=0)){for(let T of b){let S=T[0];p[S]=T[1]}w()}},E=(b,T)=>`${b}-${T}`,z=(b,T,S)=>{let x=a[S];if(!x)return;let $=S===0?n:x.$pointer;if(T==null){v.has(E(b,S))&&v.delete(E(b,S)),$.style.removeProperty(b);return}v.set(E(b,S),T),$.style.setProperty(b,T)},H=(b,T)=>v.get(E(b,T));return(()=>{for(let b of Lt){let[T,S,x,$]=b;if($){let R=ce(t,$);for(let B of R){let I=B[0],W=B[1];z(T,W,I)}}else{let R=t.getAttribute(S);z(T,R,0)}let F=[];if(x.indexOf("#")===-1)F.push([x,0]);else{F.push([x.replace("#",""),0]),F.push([x.replace("#","0"),0]),F.push([x.replace("#","1"),0]);for(let R=1;R<a.length;R++)F.push([x.replace("#",(R+1).toString()),R])}for(let R of F)try{let B=R[0],I=R[1];Object.prototype.hasOwnProperty.call(t,B)||Object.defineProperty(t,B,{get(){return H(T,I)},set:W=>{z(T,W,I)}})}catch(B){console.error(B)}}g(t.getAttribute(ct)),f()})(),{setStyle:z,getStyle:H,get theme(){return l},set theme(b){g(b)},get pointerShapes(){return p},setPointerShape:M}},ne="animate-on-click",yt="range-dragging",Zr=(t,n,a,l)=>{let p=[],v=M=>{for(let f of p)f.update&&typeof f.update=="function"&&f.update(M)},y=()=>{for(let M of p)M.destroy&&typeof M.destroy=="function"&&M.destroy()},h=(M,f)=>{for(let E of p)E.onAttrChange&&typeof E.onAttrChange=="function"&&E.onAttrChange(M,f)},g=M=>{if(M.gettersAndSetters){for(let f of M.gettersAndSetters)if(!(!f.name||!f.attributes))try{Object.prototype.hasOwnProperty.call(t,f.name)||Object.defineProperty(t,f.name,f.attributes)}catch(E){console.error("defineSettersGetters error:",E)}}},w=M=>{var f;if(!M.css)return;let E=(f=t.shadowRoot)==null?void 0:f.querySelector("style");!E||(E.innerHTML+=M.css)};return{init:()=>{if(window.tcRangeSliderPlugins)for(let M of window.tcRangeSliderPlugins){let f=M();p.push(f),f.init&&typeof f.init=="function"&&(f.init(t,n,a,l),g(f),w(f))}},update:v,onAttrChange:h,destroy:y}},en=10,wt=20,tn=(t,n)=>{let a=new Map,l=/^value([0-9]*)$/;for(let h of t.attributes){let g=h.nodeName.trim().toLowerCase();if(!l.test(g))continue;let w=g.replace("value","").trim(),M=w===""||w==="0"||w==="1"?0:A(w,0)-1,f=G(h.value)?A(h.value,0):h.value;a.set(M,f)}let p=Math.max(...Array.from(a.keys())),v=[];v.push([Be(t,n,0),a.get(0)]);let y=n;for(let h=1;h<=p;h++){let g=n.cloneNode(!0);y.after(g),y=g,v.push([Be(t,g,h),a.get(h)])}return v},Tt=(t,n,a,l,p,v,y)=>{try{Object.defineProperty(t,l,{configurable:!0,get(){if(!n)return;let h=n.pointers[a];if(!h)return;let g=n.getTextValue(h.percent);return G(g)?A(g,g):g},set:h=>{n.pointers[a]?n?.setValue(h,a):n?.addPointer(h)}}),Object.defineProperty(t,p,{configurable:!0,get(){var h,g;return(g=(h=n?.pointers[a])==null?void 0:h.getAttr("aria-label"))!=null?g:void 0},set:h=>{!n||n.setAriaLabel(a,h)}}),Object.defineProperty(t,v,{configurable:!0,get(){var h,g;return(g=(h=n?.styles)==null?void 0:h.pointerShapes[a])!=null?g:null},set:h=>{!n||!n.styles||n.styles.setPointerShape(a,h)}}),Object.defineProperty(t,y,{configurable:!0,get(){var h;return(h=n?.pointers[a].disabled)!=null?h:!1},set:h=>{if(!n)return;let g=n?.pointers[a];!g||(g.disabled=h)}})}catch(h){console.error(h)}},rn=(t,n)=>{let a=[["value","ariaLabel","pointerShape","pointerDisabled",0],["value0","ariaLabel0","pointerShape0","pointer0Disabled",0],["value1","ariaLabel1","pointerShape1","pointer1Disabled",0]];for(let l=2;l<en;l++)a.push([`value${l}`,`ariaLabel${l}`,`pointer${l}Shape`,`pointer${l}Disabled`,l-1]);for(let l of a)Tt(t,n,l[4],l[0],l[1],l[2],l[3])},Mt=(t,n,a)=>{var l;let p=(l=a.shadowRoot)==null?void 0:l.querySelector(".container");if(p)for(let v of t)n?p.prepend(v.$pointer):p.append(v.$pointer)},nn=(t,n)=>{if(!(!n||t.length<=1)){for(let a of t)a.$pointer.style.zIndex=wt.toString();n.$pointer.style.zIndex=(wt*2).toString()}},ke=0,oe=100,ie=2,Ot="0.3s",sn=(t,n,a)=>{let l=a.map(r=>r[0]),p=null,v=null,y=null,h=null,g=ke,w=oe,M,f,E=re,z=ie,H=!1,b=!1,T=!1,S=0,x=1/0,$=!1,F,R,B=!1,I=!1,W=!1,Q=Ot,Et=[],Dt=r=>{B||(r.preventDefault&&r.preventDefault(),ee(r),window.addEventListener("mousemove",ee),window.addEventListener("mouseup",pe),Er(t,r))},pe=r=>{B||(F=void 0,R=void 0,window.removeEventListener("mousemove",ee),window.removeEventListener("mouseup",pe),Q&&n.classList.add(ne),Dr(t,r))},an=(r,d)=>{if(l.length<=0)return;if(l.length===1)return l[0].isClicked(r)&&Q&&n.classList.remove(ne),l[0];let m=un(r);if($){let O=d,j=ge(O);j!==void 0&&(O=bt(O,j)),m?(F=O,R=0,Q&&n.classList.remove(ne)):F!==void 0&&(R=O-F,F=O)}if(!dn(r)&&!m){for(let O of l)if(!(!O.isClicked(r)||O.disabled))return Q&&n.classList.remove(ne),O;for(let O of l)if(p===O)return O}let D=1/0,k=null;for(let O of l){if(O.disabled)continue;let j=Math.abs(d-O.percent);j<D&&(D=j,k=O)}return k},xt=()=>l.findIndex(r=>p===r&&!r.disabled),ee=r=>{let d;if(E===N){let{height:D,top:k}=n.getBoundingClientRect(),O=r.type.indexOf("mouse")!==-1?r.clientY:r.touches[0].clientY;d=Math.min(Math.max(0,O-k),D)*100/D}else{let{width:D,left:k}=n.getBoundingClientRect(),O=r.type.indexOf("mouse")!==-1?r.clientX:r.touches[0].clientX;d=Math.min(Math.max(0,O-k),D)*100/D}if((H||b)&&(d=100-d),p=an(r.target,d),p&&nn(l,p),$&&l.length>1&&R!==void 0){let D=l[0],k=l[l.length-1],O=D.percent+R<0,j=k.percent+R>100;if(O||j)return;for(let we=0;we<l.length;we++)V(we,l[we].percent+R);return}let m=xt();m!==-1&&(V(m,d),p?.$pointer.focus())},he=r=>{if(B||document.activeElement!==t||p?.disabled)return;r.stopPropagation(),r.preventDefault();let d=r.deltaY<0,m=H||b,D=d?!m:m,k=xt();k!==-1&&(D?le(k,l[k].percent):ae(k,l[k].percent))},Ct=r=>{B||I||(E===N?b?V(r,100):V(r,0):H?ae(r,l[r].percent):le(r,l[r].percent))},Rt=r=>{B||I||(E===N?b?V(r,0):V(r,100):H?le(r,l[r].percent):ae(r,l[r].percent))},Bt=r=>{B||I||(E===N?b?ae(r,l[r].percent):le(r,l[r].percent):H?V(r,100):V(r,0))},kt=r=>{B||I||(E===N?b?le(r,l[r].percent):ae(r,l[r].percent):H?V(r,0):V(r,100))},dn=r=>r.classList.contains("panel"),un=r=>r.classList.contains("panel-fill"),le=(r,d)=>{if(d===void 0)return;let m=ge(d);m==null&&(m=1),d-=m,d<0&&(d=0),V(r,d)},ae=(r,d)=>{if(d===void 0)return;let m=ge(d);m==null&&(m=1),d+=m,d>100&&(d=100),V(r,d)},te=()=>{!h||h.update({percents:At(),values:Ft(),$pointers:Pt(),min:$t(),max:_t(),data:Pe(),step:Fe(),round:_e(),type:$e(),textMin:me(),textMax:fe(),rightToLeft:Ie(),bottomToTop:We(),pointersOverlap:je(),pointersMinDistance:He(),pointersMaxDistance:Ue(),rangeDragging:qe(),disabled:Ve(),keyboardDisabled:ze(),mousewheelDisabled:Ne()})},cn=()=>{te()},pn=r=>{if(!(T||l.length<=1||w===g))if(r===0){let d=x*100/(w-g);return Math.max(0,l[r+1].percent-d)}else{let d=S*100/(w-g);return Math.min(l[r-1].percent+d,100)}},hn=r=>{if(!(T||l.length<=1||w===g))if(r===l.length-1){let d=x*100/(w-g);return Math.min(l[r-1].percent+d,100)}else{let d=S*100/(w-g);return Math.max(0,l[r+1].percent-d)}},ge=r=>{let d;if(typeof M=="function"){let m=Re(0,100,g,w,r);d=M(m,r)}else d=M;if(G(d)){let m=w-g;return d=m===0?0:d*100/m,d}},se=r=>{if(r===void 0)return;let d=Re(0,100,g,w,r);return f!==void 0?f[Math.round(d)]:Mr(d,z)},me=()=>f!==void 0?f[g]:g,fe=()=>f!==void 0?f[w]:w,Fe=()=>M,gn=r=>{var d;return r<=0||T?me():(d=se(l[r-1].percent))!=null?d:""},mn=r=>{var d;return l.length<=1||r>=l.length-1||T?fe():(d=se(l[r+1].percent))!=null?d:""},At=()=>l.map(r=>r.percent),Ft=()=>l.map(r=>se(r.percent)),Pt=()=>l.map(r=>r.$pointer),$t=()=>g,_t=()=>w,Pe=()=>f,$e=()=>E,_e=()=>z,He=()=>S,Ue=()=>x,fn=r=>Et[r],Ie=()=>H,We=()=>b,Ve=()=>B,ze=()=>I,Ne=()=>W,je=()=>T,qe=()=>$,V=(r,d)=>{if(d===void 0)return;let m=ge(d);m!==void 0&&(d=bt(d,m));let D=l[r];if(!D)return;let k=D.updatePosition(d,pn(r),hn(r),E,H,b);v?.updatePosition(E,l.map(O=>O.percent),H,b),te();for(let O of l){let j=se(O.percent);j!==void 0&&(O.setAttr("aria-valuenow",j.toString()),O.setAttr("aria-valuetext",j.toString()))}bn(),k&&Cr(t,l.map(O=>se(O.percent)))},Y=()=>{for(let r=0;r<l.length;r++)V(r,l[r].percent)},vn=(r,d)=>{g=f!==void 0?0:A(r,ke),w=f!==void 0?f.length-1:A(d,oe),ve(g),be(w)},bn=()=>{var r,d;for(let m=0;m<l.length;m++){let D=l[m];D.setAttr("aria-valuemin",((r=gn(m))!=null?r:"").toString()),D.setAttr("aria-valuemax",((d=mn(m))!=null?d:"").toString())}},ve=r=>{g=A(r,ke),g>w&&(w=g+oe),Y()},be=r=>{w=A(r,oe),w<g&&(w=g+oe),Y()},Ht=r=>{T=!0;for(let d=0;d<r.length;d++)Se(r[d],d);T=!1;for(let d=0;d<r.length;d++)Se(r[d],d)},Se=(r,d)=>{let m;f!==void 0?(m=r==null?0:Br(r,f),m===-1&&(m=0)):(m=A(r,g),m<g&&(m=g),m>w&&(m=w));let D=Re(g,w,0,100,m);V(d,D)},Le=r=>{if(r==null){M=void 0;return}if(typeof r=="function"){M=r,Y();return}if(G(r)){M=A(r,1);let d=Math.abs(w-g);M>d&&(M=void 0),Y();return}M=void 0},Je=r=>{T=r,Y()},Ye=r=>{(!G(r)||r<0)&&(r=0),S=r},Ge=r=>{(!G(r)||r<0)&&(r=1/0),x=r},Ke=r=>{B=r,n.classList.toggle("disabled",B),B?n.setAttribute("aria-disabled","true"):n.hasAttribute("aria-disabled")&&n.removeAttribute("aria-disabled")},Ut=r=>{I=r},It=r=>{W=r,W?document.removeEventListener("wheel",he):document.addEventListener("wheel",he,{passive:!1})},Xe=r=>{if(r==null){f=void 0;return}if(f=Rr(r),f===void 0||f.length<=0){f=void 0;return}ve(0),be(f.length-1),M===void 0&&Le(1)},Qe=r=>{var d;typeof r=="string"?E=r.trim().toLowerCase()===N?N:re:E=re;let m=(d=t.shadowRoot)==null?void 0:d.querySelector(".range-slider-box");if(!m)return;m.className=`range-slider-box type-${E}`,Y();let D=E===N?"vertical":"horizontal";for(let k of l)k.setAttr("aria-orientation",D)},Ze=r=>{H=r,l.length>1&&Mt(l,H,t),Y(),te()},et=r=>{b=r,l.length>1&&Mt(l,b,t),Y(),te()},tt=r=>{z=A(r,ie),z<0&&(z=ie),te()},Wt=r=>{r==null||r.toString().trim().toLowerCase()==="false"?(Q=void 0,n.style.removeProperty(St),n.classList.remove(ne)):(Q=r.toString(),n.style.setProperty(St,Q),n.classList.add(ne))},Vt=(r,d)=>{let m=l[r];!m||(m.setAttr("aria-label",d),Et[r]=d)},ye=r=>{if(F=void 0,l.length<=1){$=!1,n.classList.remove(yt);return}$=r,n.classList.toggle(yt,$)},Sn=()=>{Ke(_(t.getAttribute(gt))),I=_(t.getAttribute(mt)),W=_(t.getAttribute(ft));let r=ce(t,/^pointer([0-9]*)-disabled$/,d=>_(d));for(let d of r){let m=d[0];!l[m]||(l[m].disabled=d[1])}},Ln=()=>{let r=ce(t,/^aria-label([0-9]*)$/);for(let d of r){let m=d[0];Vt(m,d[1])}},yn=r=>{let d=l.length,m=l[d-1].$pointer,D=m.cloneNode(!0);m.after(D);let k=Be(t,D,d);return k.setCallbacks(Ct,Rt,Bt,kt),l.push(k),Se(r,d),Y(),te(),d},wn=()=>{let r=l.length,d=l[r-1];return d?(d.destroy(),l.pop(),l.length<=1&&ye(!1),Y(),te(),r-1):-1};return(()=>{var r,d;for(let D of l)D.setCallbacks(Ct,Rt,Bt,kt);let m=(r=t.shadowRoot)==null?void 0:r.querySelector(".panel-fill");m&&(v=kr(m)),Qe(t.getAttribute(ut)),Ze(_(t.getAttribute(pt))),et(_(t.getAttribute(ht))),vn(t.getAttribute(ue),t.getAttribute(lt)),Le(t.getAttribute(at)),Xe(t.getAttribute(X)),Ht(a.map(D=>D[1])),Je(_(t.getAttribute(L))),Ye(A(t.getAttribute(C),0)),Ge(A(t.getAttribute(U),1/0)),ye(_(t.getAttribute(J))),tt(A(t.getAttribute(dt),ie)),Sn(),Ln(),y=Qr(t,n,l),Wt((d=t.getAttribute(vt))!=null?d:Ot),n.addEventListener("mousedown",Dt),n.addEventListener("mouseup",pe),n.addEventListener("touchmove",ee),n.addEventListener("touchstart",ee),W||document.addEventListener("wheel",he,{passive:!1}),h=Zr(t,cn,{setValues:Ht,setMin:ve,setMax:be,setStep:Le,setPointersOverlap:Je,setPointersMinDistance:Ye,setPointersMaxDistance:Ge,setDisabled:Ke,setType:Qe,setRightToLeft:Ze,setBottomToTop:et,setRound:tt,setKeyboardDisabled:Ut,setMousewheelDisabled:It,setRangeDragging:ye,setData:Xe},{getPercents:At,getValues:Ft,getPointerElements:Pt,getMin:$t,getMax:_t,getStep:Fe,getData:Pe,getType:$e,getRound:_e,getTextMin:me,getTextMax:fe,isRightToLeft:Ie,isBottomToTop:We,isDisabled:Ve,isKeyboardDisabled:ze,isMousewheelDisabled:Ne,isPointersOverlap:je,isRangeDraggingEnabled:qe,getPointersMinDistance:He,getPointersMaxDistance:Ue}),h.init()})(),{get pointers(){return l},get styles(){return y},get pluginsManager(){return h},get min(){return me()},get max(){return fe()},get step(){return Fe()},get pointersOverlap(){return je()},set pointersOverlap(r){Je(r)},get pointersMinDistance(){return He()},set pointersMinDistance(r){Ye(r)},get pointersMaxDistance(){return Ue()},set pointersMaxDistance(r){Ge(r)},get disabled(){return Ve()},set disabled(r){Ke(r)},get data(){return Pe()},get type(){return $e()},set type(r){Qe(r)},get rightToLeft(){return Ie()},set rightToLeft(r){Ze(r)},get bottomToTop(){return We()},set bottomToTop(r){et(r)},get round(){return _e()},set round(r){tt(r)},get animateOnClick(){return Q},set animateOnClick(r){Wt(r)},get keyboardDisabled(){return ze()},set keyboardDisabled(r){Ut(r)},get mousewheelDisabled(){return Ne()},set mousewheelDisabled(r){It(r)},get rangeDragging(){return qe()},set rangeDragging(r){ye(r)},setMin:ve,setMax:be,setValue:Se,setStep:Le,setData:Xe,getTextValue:se,setAriaLabel:Vt,getAriaLabel:fn,addPointer:yn,removePointer:wn,destroy:()=>{n.removeEventListener("mousedown",Dt),n.removeEventListener("mouseup",pe),n.removeEventListener("touchmove",ee),n.removeEventListener("touchstart",ee),document.removeEventListener("wheel",he);for(let r of l)r.destroy();h?.destroy()}}},on=(t,n,a)=>{let l=Lt.find(([h,g,w,M])=>g.replace("#","")===n.replace(/\d+/g,""));if(l&&t.styles){let[h,g,w,M]=l,f=n.replace(/\D/g,"").trim(),E=f===""||f==="0"||f==="1"?0:A(f,0)-1;t.styles.setStyle(h,a,E);return}switch(t&&t.pluginsManager&&t.pluginsManager.onAttrChange(n,a),n){case ue:{t.setMin(a);break}case lt:{t.setMax(a);break}case at:{t.setStep(a);break}case L:{t.pointersOverlap=_(a);break}case C:{t.pointersMinDistance=A(a,0);break}case J:{t.rangeDragging=_(a);break}case U:{t.pointersMaxDistance=A(a,1/0);break}case gt:{t.disabled=_(a);break}case mt:{t.keyboardDisabled=_(a);break}case ft:{t.mousewheelDisabled=_(a);break}case X:{t.setData(a);break}case ut:{t.type=a;break}case pt:{t.rightToLeft=_(a);break}case ht:{t.bottomToTop=_(a);break}case dt:{t.round=A(a,ie);break}case ct:{t.styles&&(t.styles.theme=a);break}case vt:{t.animateOnClick=a;break}}let p=null;if(/^value([0-9]*)$/.test(n)&&(p="value"),/^pointer([0-9]*)-disabled$/.test(n)&&(p="pointer-disabled"),/^aria-label([0-9]*)$/.test(n)&&(p="aria-label"),/^pointer([0-9]*)-shape$/.test(n)&&(p="pointer-shape"),!p)return;let v=n.replace(/\D/g,"").trim(),y=v===""||v==="0"||v==="1"?0:A(v,0)-1;switch(p){case"value":{t.setValue(a,y);break}case"pointer-disabled":{let h=t?.pointers[y];if(!h)return;h.disabled=_(a);break}case"aria-label":{t.setAriaLabel(y,a);break}case"pointer-shape":{t.styles&&t.styles.setPointerShape(y,a);break}}},ln=class extends HTMLElement{constructor(){super(),s(this,"slider"),s(this,"_externalCSSList",[]),s(this,"_observer",null),this.attachShadow({mode:"open"})}set step(t){this.slider&&this.slider.setStep(t)}get step(){var t;return(t=this.slider)==null?void 0:t.step}set disabled(t){this.slider&&(this.slider.disabled=t)}get disabled(){var t,n;return(n=(t=this.slider)==null?void 0:t.disabled)!=null?n:!1}set data(t){var n;(n=this.slider)==null||n.setData(t)}get data(){var t;return(t=this.slider)==null?void 0:t.data}set min(t){var n;(n=this.slider)==null||n.setMin(t)}get min(){var t;return(t=this.slider)==null?void 0:t.min}set max(t){var n;(n=this.slider)==null||n.setMax(t)}get max(){var t;return(t=this.slider)==null?void 0:t.max}set round(t){!this.slider||(this.slider.round=t)}get round(){var t,n;return(n=(t=this.slider)==null?void 0:t.round)!=null?n:ie}set type(t){!this.slider||(this.slider.type=t??re)}get type(){var t;return((t=this.slider)==null?void 0:t.type)||re}set pointersOverlap(t){!this.slider||(this.slider.pointersOverlap=t)}get pointersOverlap(){var t,n;return(n=(t=this.slider)==null?void 0:t.pointersOverlap)!=null?n:!1}set pointersMinDistance(t){!this.slider||(this.slider.pointersMinDistance=t)}get pointersMinDistance(){var t,n;return(n=(t=this.slider)==null?void 0:t.pointersMinDistance)!=null?n:0}set pointersMaxDistance(t){!this.slider||(this.slider.pointersMaxDistance=t)}get pointersMaxDistance(){var t,n;return(n=(t=this.slider)==null?void 0:t.pointersMaxDistance)!=null?n:1/0}set theme(t){!this.slider||!this.slider.styles||(this.slider.styles.theme=t)}get theme(){var t,n,a;return(a=(n=(t=this.slider)==null?void 0:t.styles)==null?void 0:n.theme)!=null?a:null}set rtl(t){!this.slider||(this.slider.rightToLeft=t)}get rtl(){var t,n;return(n=(t=this.slider)==null?void 0:t.rightToLeft)!=null?n:!1}set btt(t){!this.slider||(this.slider.bottomToTop=t)}get btt(){var t,n;return(n=(t=this.slider)==null?void 0:t.bottomToTop)!=null?n:!1}set keyboardDisabled(t){!this.slider||(this.slider.keyboardDisabled=t)}get keyboardDisabled(){var t,n;return(n=(t=this.slider)==null?void 0:t.keyboardDisabled)!=null?n:!1}set mousewheelDisabled(t){!this.slider||(this.slider.mousewheelDisabled=t)}get mousewheelDisabled(){var t,n;return(n=(t=this.slider)==null?void 0:t.mousewheelDisabled)!=null?n:!1}set animateOnClick(t){!this.slider||(this.slider.animateOnClick=t)}get animateOnClick(){var t;return(t=this.slider)==null?void 0:t.animateOnClick}get rangeDragging(){var t,n;return(n=(t=this.slider)==null?void 0:t.rangeDragging)!=null?n:!1}set rangeDragging(t){this.slider&&(this.slider.rangeDragging=_(t))}get externalCSSList(){return this._externalCSSList}addPointer(t){var n,a;if(!this.slider)return;let l=(a=(n=this.slider)==null?void 0:n.addPointer(t))!=null?a:0;Tt(this,this.slider,l,`value${l+1}`,`ariaLabel${l+1}`,`pointerShape${l+1}`,`pointer${l+1}Disabled`)}removePointer(){var t;!this.slider||(t=this.slider)==null||t.removePointer()}addCSS(t){if(!this.shadowRoot)return;let n=document.createElement("style");n.textContent=t,this.shadowRoot.appendChild(n)}connectedCallback(){var t,n;if(!this.shadowRoot)return;this._externalCSSList=Xr(this),this.shadowRoot.innerHTML=o(u,this._externalCSSList);let a=(t=this.shadowRoot)==null?void 0:t.querySelector(".pointer");if(!a)return;let l=(n=this.shadowRoot)==null?void 0:n.getElementById("range-slider");if(!l)return;let p=tn(this,a);this.slider=sn(this,l,p),rn(this,this.slider),this._observer=new MutationObserver(v=>{v.forEach(y=>{var h;if(!this.slider||y.type!=="attributes")return;let g=y.attributeName;!g||on(this.slider,g,(h=this.getAttribute(g))!=null?h:"")})}),this._observer.observe(this,{attributes:!0})}disconnectedCallback(){this._observer&&this._observer.disconnect(),this.slider&&this.slider.destroy()}},Ae=ln;window.tcRangeSlider=Ae,customElements.get("toolcool-range-slider")||customElements.define("toolcool-range-slider",Ae),customElements.get("tc-range-slider")||customElements.define("tc-range-slider",class extends Ae{})})();var Ce=class extends HTMLElement{get range_min(){return Number(this.slider.value1)}set range_min(e){this.slider.value1=e}get range_max(){return Number(this.slider.value2)}set range_max(e){this.slider.value2=e}slider;label_range_min;label_range_max;constructor(){super(),this.attachShadow({mode:"open"});let e=document.createElement("div"),i=document.createElement("span");i.textContent="\u79FB\u52D5\u7BC4\u56F2: ",e.appendChild(i);let s=document.createElement("span");s.textContent="0",e.appendChild(s),this.label_range_min=s;let o=document.createElement("tc-range-slider");o.style.padding="0 1em",o.style.display="inline-block",e.appendChild(o),this.slider=o;let u=document.createElement("span");s.textContent="100",e.appendChild(u),this.label_range_max=u,this.shadowRoot?.append(e),this.slider.addEventListener("change",L=>{this.label_range_min.textContent=String(this.slider.value1),this.label_range_max.textContent=String(this.slider.value2)}),this.slider.addEventListener("mouseup",L=>{console.log(`min: ${this.range_min}, max: ${this.range_max}`)})}InitializeSlider(){this.slider.min=0,this.slider.max=100,this.slider.step=1,this.slider.value1=0,this.slider.value2=100,this.slider.sliderWidth="200px",this.slider.style.padding="0 1em"}};customElements.define("slider-container",Ce);var In;async function Wn(){console.log("main loaded."),In=new xe}window.onload=Wn;
